{% extends 'base.html' %}
{% block content %}
<div class="container">
  <h2>{{ template_data.title }}</h2>
  <hr>
  <!-- display conversation list: latest message per partner -->
  {% for convo in template_data.conversations %}
    <a href="{% url 'messages.thread' convo.partner.id %}" class="text-decoration-none text-dark">
      <div class="card mb-3">
        <div class="card-body d-flex justify-content-between align-items-start">
          <div>
            <strong>{{ convo.partner.username }}</strong>
            {% if convo.unread and convo.unread > 0 %}
              <span class="badge bg-warning text-dark ms-2">{{ convo.unread }}</span>
            {% endif %}
            <div class="small text-muted">{{ convo.latest.timestamp|date:"M d, Y H:i" }}</div>
            <div class="mt-2">{{ convo.latest.body|truncatechars:140 }}</div>
          </div>
          <div class="ms-3 text-end">
            {% if convo.latest.sender == request.user %}
              <small class="text-muted">You</small>
            {% else %}
              <small class="text-muted">{{ convo.latest.sender.username }}</small>
            {% endif %}
          </div>
        </div>
      </div>
    </a>
  {% empty %}
    <p>No conversations yet.</p>
  {% endfor %}
  
  <!--send messages-->
  <a href="{% url 'home.recruiter_send_messages' %}" class="btn btn-secondary mb-2">Send Message</a>
  <a href="{% url 'messages.send_email' %}" class="btn btn-secondary mb-2">Send Email</a>
  <a href="{% url 'messages.email_inbox' %}" class='btn btn-secondary mb-2'>Email Inbox</a>
</div>
{% endblock %}