{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
  <h2>{{ template_data.title }}</h2>
  <hr>

  {% if template_data.applications %}
  <table class="table table-bordered align-middle">
    <thead class="table-dark">
      <tr>
        <th>Applicant</th>
        <th>Status</th>
        <th>Last Updated</th>
        <th>Note</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for app in template_data.applications %}
      <tr>
        <!-- Applicant info -->
        <td>
          <strong>{{ app.applicant.username }}</strong><br>
          {% with p=app.applicant.profile %}
            {% if p.show_headline and p.headline %}
              <small><strong>Headline:</strong> {{ p.headline }}</small><br>
            {% endif %}
            {% if p.show_location and p.location %}
              <small><strong>Location:</strong> {{ p.location }}</small><br>
            {% endif %}
            {% if p.show_skills and p.skills %}
              <small><strong>Skills:</strong> {{ p.skills }}</small><br>
            {% endif %}
            {% if p.show_education and p.education %}
              <small><strong>Education:</strong> {{ p.education }}</small><br>
            {% endif %}
            {% if p.show_projects and p.projects %}
              <small><strong>Projects:</strong> {{ p.projects }}</small><br>
            {% endif %}
            {% if p.show_experience and p.experience %}
              <small><strong>Experience:</strong> {{ p.experience }}</small><br>
            {% endif %}
            {% if p.show_links and p.links %}
              <small><strong>Links:</strong> {{ p.links }}</small><br>
            {% endif %}
          {% endwith %}
        </td>

        <!-- Status column with colors and icons -->
        <td class="text-center">
          <form method="post" action="{% url 'applications:manage' template_data.job.id %}">
            {% csrf_token %}
            <input type="hidden" name="app_id" value="{{ app.id }}">

            {% comment %}
              Show colored badge + icon for current status
            {% endcomment %}
            {% if app.status == 'APPLIED' %}
              <span class="badge bg-secondary">
                <i class="fas fa-paper-plane"></i> Applied
              </span>
            {% elif app.status == 'REVIEW' %}
              <span class="badge bg-info text-dark">
                <i class="fas fa-search"></i> Review
              </span>
            {% elif app.status == 'INTERVIEW' %}
              <span class="badge bg-warning text-dark">
                <i class="fas fa-comments"></i> Interview
              </span>
            {% elif app.status == 'OFFER' %}
              <span class="badge bg-success">
                <i class="fas fa-handshake"></i> Offer
              </span>
            {% elif app.status == 'CLOSED' %}
              <span class="badge bg-danger">
                <i class="fas fa-times-circle"></i> Closed
              </span>
            {% endif %}

            <!-- Dropdown to change status -->
            <select name="status" class="form-select form-select-sm mt-2">
              {% for value, label in app.Status.choices %}
                <option value="{{ value }}" {% if app.status == value %}selected{% endif %}>
                  {{ label }}
                </option>
              {% endfor %}
            </select>
        </td>

        <td>{{ app.updated_at|date:"Y-m-d H:i" }}</td>

        <td>
          {% if app.notes %}
          <span class="d-inline-block text-truncate" style="max-width: 280px;">
            {{ app.notes }}
          </span>
          {% else %}
          <span class="text-muted">â€”</span>
          {% endif %}
        </td>

        <td class="text-center">
          <button type="submit" class="btn btn-sm btn-primary">Update</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>No applications yet for this job.</p>
  {% endif %}
</div>

<!-- Add icons support -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
{% endblock %}
